<?php

class accesBD
	{
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//--------------------------ATTRIBUTS PRIVES--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	private $hote;
	private $login;
	private $passwd;
	private $base;
	
	
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//--------------------------CONSTRUCTEUR------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function __construct()
		{
		$this->hote="localhost";
		$this->login="root";
		$this->passwd="";
		$this->base="paniersolidaire";
		}
	
	
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-----------------------------CONNECTION A LA BASE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	private function connexion()
		{
		$cnx = new mysqli($this->hote,$this->login,$this->passwd,$this->base);
		if(mysqli_connect_error()!="")
		{
			echo mysqli_connect_error();
			return 0;
		}
		else
			return $cnx;
		}
	
	
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//CHARGEMENT DES INFORMATIONS DE LA BASE--------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function chargement($uneTable)
		{
		$lesInfos=null;
		$nbTuples=0;
		//définition de la requête SQL
		$requete = "SELECT * FROM ".$uneTable;
		//exécution de la requête SQL
		$resultat=$this->execRequete($requete);
		//POUR chaque tuple retourné par la requête SQL
		while($unTuple=$resultat->fetch_row())
			{
			$nbChamps=0;
			//POUR chaque champ du tuple courant
			while ($nbChamps<$resultat->field_count)
				{
				//enregistrement du champ dans la bonne case du tableau à deux dimensions
				$lesInfos[$nbTuples][$nbChamps]=$unTuple[$nbChamps];
				$nbChamps++;
				}
			$nbTuples++;				
			}
		//retour du tableau à deux dimension
		return $lesInfos;
		}	
		
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//CREATION DE LA REQUETE D'INSERTION PRODUIT-------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function insertProduit($unLibelle)
		{
		//génération automatique de l'identifiant
		$sonId = $this->donneProchainIdentifiant("Produit","code");
		//définition de la requête SQL
		$requete = "INSERT INTO Produit (code,libelle) VALUES (";
		$requete .= $sonId.",";
		$requete .= $unLibelle.")";
		//exécution de la requête SQL
		$this->execRequete($requete);
		//retour de l'identifiant du nouveau tuple
		return $sonId;
		}
		
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//CREATION DE LA REQUETE D'INSERTION PANIER-------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function insertPanier($uneDate)
		{
		//définition de la requête SQL
		$requete = "INSERT INTO Panier (datePanier) VALUES ('";
		$requete .= $uneDate."')";
		//exécution de la requête SQL
		$this->execRequete($requete);
		}
			
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//CREATION DE LA REQUETE D'EXISTENCE DU PANIER-------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function existsPanier($uneDate)
		{
		//définition de la requête SQL
		$requete = "SELECT COUNT(*) FROM Panier WHERE datePanier = '";
		$requete .= $uneDate."'";
		//exécution de la requête SQL
		$resultat=$this->execRequete($requete);
		$ligne=$resultat->fetch_row();
		if($ligne[0]==0)
			return false;
		else
			return true;
		}
		
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//CREATION DE LA REQUETE D'INSERTION CONTENU-------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function insertContenu($uneDate,$unCodeProduit,$uneQte)
		{
		//définition de la requête SQL
		$requete = "INSERT INTO Contenir (datePanier,codeProduit,quantite) VALUES ('";
		$requete .= $uneDate."',";
		$requete .= $unCodeProduit.",";
		$requete .= $uneQte.")";
		//exécution de la requête SQL
		return $this->execRequete($requete);
		}
		
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-----------------------------EXECUTION D'UNE REQUETE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	private function execRequete($uneRequete)
		{
		$resultat = $this->connexion()->query($uneRequete);
		return $resultat;
		}
	
	
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-----------------------------DONNE LE PROCHAIN INDENTIFIANT---------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	private function donneProchainIdentifiant($uneTable,$unIdentifiant)
		{
		$prochainId[0]=0;
		//définition de la requête SQL
		$requete="SELECT MAX(".$unIdentifiant.") FROM ".$uneTable;
		//exécution de la requête SQL
		$resultat=$this->execRequete($requete);
		$prochainId = $resultat->fetch_row();
		//retour de l'identifiant suivant (+1)
		return $prochainId[0]+1;
		}
		
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-----------------------------EXECUTE LA REQUETE POUR AJAX---------------------------------------------------------------------------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function executeRequeteSQLpourAJAX($uneRequete)
		{
		return $this->execRequete($uneRequete);
		}
		
	}

?>